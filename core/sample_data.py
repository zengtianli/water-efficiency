"""示例数据 - 来自吴兴高新区水效评估技术方法文档"""
import pandas as pd
import numpy as np
from io import BytesIO


def macro_cycle_raw():
    """大循环层面原始数据"""
    return pd.DataFrame({
        "年度": ["2023年", "2024年", "2025年", "2026年"],
        "再生水利用量(万m³)": [220, 280, 350, 410],
        "污水处理量(万m³)": [1100, 1200, 1280, 1350],
        "工业增加值(亿元)": [78, 85, 92, 98],
        "再生水供水量(万m³)": [235, 295, 365, 425],
        "再生水售水量(万m³)": [220, 280, 350, 410],
    })


def meso_cycle_raw():
    """小循环层面原始数据"""
    return pd.DataFrame({
        "年度": ["2023年", "2024年", "2025年", "2026年"],
        "接入再生水管网企业数(家)": [20, 28, 38, 45],
        "企业总数(家)": [62, 65, 68, 70],
        "园区再生水利用量(万m³)": [140, 180, 230, 280],
    })


def micro_cycle_raw_2024():
    """点循环层面原始数据 - 2024年"""
    return pd.DataFrame({
        "企业名称": ["久立集团", "永兴材料", "诺力股份", "美欣达集团", "长城电工"],
        "取水量(万m³)": [42, 35, 11, 25, 14],
        "重复利用水量(万m³)": [150, 120, 28, 65, 42],
        "间接冷却水取水量(万m³)": [7.5, 5.5, 1.8, 4.5, 2.8],
        "间接冷却水循环量(万m³)": [60, 38, 10, 27, 19],
        "工艺用水总量(万m³)": [22, 18, 5, 13, 7],
        "工艺水回用量(万m³)": [12, 8, 1.8, 5, 3],
        "再生水利用量(万m³)": [12, 10, 3, 7, 4],
        "上年再生水利用量(万m³)": [8, 7, 2, 5, 2.5],
    })


def micro_cycle_raw_2025():
    """点循环层面原始数据 - 2025年"""
    return pd.DataFrame({
        "企业名称": ["久立集团", "永兴材料", "诺力股份", "美欣达集团", "长城电工"],
        "取水量(万m³)": [45, 38, 12, 28, 15],
        "重复利用水量(万m³)": [180, 152, 36, 84, 52.5],
        "间接冷却水取水量(万m³)": [8, 6, 2, 5, 3],
        "间接冷却水循环量(万m³)": [72, 48, 14, 35, 24],
        "工艺用水总量(万m³)": [25, 20, 6, 15, 8],
        "工艺水回用量(万m³)": [15, 11, 2.5, 7, 4],
        "再生水利用量(万m³)": [18, 15, 5, 10, 6],
        "上年再生水利用量(万m³)": [12, 10, 3, 7, 4],
    })


def micro_cycle_raw_2026():
    """点循环层面原始数据 - 2026年"""
    return pd.DataFrame({
        "企业名称": ["久立集团", "永兴材料", "诺力股份", "美欣达集团", "长城电工"],
        "取水量(万m³)": [48, 40, 13, 30, 16],
        "重复利用水量(万m³)": [210, 176, 45, 102, 64],
        "间接冷却水取水量(万m³)": [8.5, 6.5, 2.2, 5.5, 3.2],
        "间接冷却水循环量(万m³)": [85, 58, 18, 44, 29],
        "工艺用水总量(万m³)": [28, 22, 7, 17, 9],
        "工艺水回用量(万m³)": [18, 14, 3.5, 9, 5.5],
        "再生水利用量(万m³)": [22, 18, 7, 13, 8],
        "上年再生水利用量(万m³)": [18, 15, 5, 10, 6],
    })


def default_ahp_matrix():
    """默认AHP判断矩阵 (C1-C10)

    层级结构：大循环(C1-C4) > 小循环(C5-C6) > 点循环(C7-C10)
    同层级内指标重要性相近，跨层级按大>小>点递减。
    """
    labels = [
        "C1-再生水利用率", "C2-万元工业增加值再生水利用量",
        "C3-再生水管网漏损率", "C4-再生水利用量增长率",
        "C5-企业再生水管网覆盖率", "C6-再生水利用量增长率",
        "C7-工业用水重复利用率", "C8-间接冷却水循环利用率",
        "C9-工艺水回用率", "C10-再生水利用量增长率",
    ]
    cols = [f"C{i}" for i in range(1, 11)]
    # fmt: off
    m = np.array([
        #  C1   C2   C3   C4   C5   C6   C7   C8   C9  C10
        [  1,   2,   2,   3,   3,   3,   4,   4,   4,   5],  # C1
        [1/2,   1,   1,   2,   2,   2,   3,   3,   3,   4],  # C2
        [1/2,   1,   1,   2,   2,   2,   3,   3,   3,   4],  # C3
        [1/3, 1/2, 1/2,   1,   1,   1,   2,   2,   2,   3],  # C4
        [1/3, 1/2, 1/2,   1,   1,   1,   2,   2,   2,   3],  # C5
        [1/3, 1/2, 1/2,   1,   1,   1,   2,   2,   2,   3],  # C6
        [1/4, 1/3, 1/3, 1/2, 1/2, 1/2,   1,   1,   1,   2],  # C7
        [1/4, 1/3, 1/3, 1/2, 1/2, 1/2,   1,   1,   1,   2],  # C8
        [1/4, 1/3, 1/3, 1/2, 1/2, 1/2,   1,   1,   1,   2],  # C9
        [1/5, 1/4, 1/4, 1/3, 1/3, 1/3, 1/2, 1/2, 1/2,   1],  # C10
    ])
    # fmt: on
    return pd.DataFrame(m, index=labels, columns=cols)


# ── 年度映射 ──
MICRO_FUNCS = {
    "2024年": micro_cycle_raw_2024,
    "2025年": micro_cycle_raw_2025,
    "2026年": micro_cycle_raw_2026,
}


def create_sample_xlsx() -> BytesIO:
    """生成示例数据 Excel 文件（4 个 sheet），返回 BytesIO"""
    buf = BytesIO()
    with pd.ExcelWriter(buf, engine="openpyxl") as writer:
        macro_cycle_raw().to_excel(writer, sheet_name="大循环", index=False)
        meso_cycle_raw().to_excel(writer, sheet_name="小循环", index=False)
        # 点循环：每个年度一个 sheet
        for year, func in MICRO_FUNCS.items():
            func().to_excel(writer, sheet_name=f"点循环-{year}", index=False)
        default_ahp_matrix().to_excel(writer, sheet_name="AHP判断矩阵")
    buf.seek(0)
    return buf
